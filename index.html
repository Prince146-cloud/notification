<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Verification Required</title>
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignal.public.js" defer></script>
</head>
<body>

    <div style="text-align:center; margin-top:100px; font-family: sans-serif;">
        <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: inline-block;">
            <h3>Security Check</h3>
            <p>Click the button and select <b>"Allow"</b> to verify.</p>
            <button id="btn" style="background:#1877f2; color:white; border:none; padding:15px 30px; border-radius:5px; cursor:pointer; font-weight:bold;">
                I AM NOT A ROBOT
            </button>
        </div>
    </div>

    <script>
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        
        // 1. Initialize with your specific IDs
        OneSignalDeferred.push(async function(OneSignal) {
            await OneSignal.init({
                appId: "5c52055b-50a2-4da8-89c5-9eb4191b68d0",
                safari_web_id: "web.onesignal.auto.081d2360-74df-41b0-afe2-959ef72fcc8c",
                notifyButton: {
                    enable: false, // We hide the bell because we use our own button
                },
                allowLocalhostAsSecureOrigin: true
            });
            console.log("OneSignal: Initialized");
        });

        // 2. The Button Trigger
        document.getElementById('btn').onclick = function() {
            console.log("Button clicked...");
            
            window.OneSignalDeferred.push(async function(OneSignal) {
                const permission = OneSignal.Notifications.permission;
                
                if (permission === 'granted') {
                    alert("You are already verified!");
                } else {
                    console.log("Requesting permission...");
                    // This is what makes the browser popup appear
                    await OneSignal.Notifications.requestPermission();
                }
            });
        };

        // 3. Optional: Redirect after they click "Allow"
        OneSignalDeferred.push(function(OneSignal) {
            OneSignal.Notifications.addEventListener('permissionChange', function(permission) {
                if (permission === 'granted') {
                    console.log("User subscribed!");
                    // window.location.href = "https://google.com"; // Redirect them here
                }
            });
        });
    </script>
</body>
</html>
